
<div class="">
    <h2 i18n="@@admmanage">User Management</h2>
    <button i18n="@@createadm" (click)="newUser()" *ngIf="!isEditing">create user</button>
    <br>

<div *ngIf="currentUser || isadmin">

    <h3 [hidden]="isEditing" i18n="@@Users">Users</h3>
    <h3 [hidden]="!isEditing"><span [hidden]="emptyUser" i18n="@@edtusers">Edit user</span><span [hidden]="!emptyUser" i18n="@@createusers">Create User</span></h3>
    <ng-container >

        <span i18n="@@searchusers">Search users: </span><input [hidden]="isEditing==true||isadmin==false" class="searchbox" [(ngModel)]="searchUser"/>

        <ul id="userlist" class="multiplist" ng-model="selectedUser" [hidden]="isEditing==true||isadmin==false">
            <li *ngFor="let user of users | filter:searchUser" (click)="onSelect(user)">{{user.email}} | {{user.name}} | {{user.location}}</li>
        </ul>
    </ng-container>

</div>

    
    
    <ng-container *ngIf="selectedUser">
        <form *ngIf="isEditing" #f="ngForm" id="userdata" class="formdata" novalidate>
            <label>
                <span i18n>ID</span>
                {{selectedUser.emailid}}
                <br/>
            </label>
            <!--<label for="login">
                <span i18n="@@username2">username</span>:
                <input *ngIf="emptyUser" [(ngModel)]="selectedUser.email" placeholder="write the username"> 
                <span *ngIf="!emptyUser" [(ngModel)]="selectedUser.email" > {{selectedUser.email}} </span>
                <span *ngIf="alreadyExist" class="alert">username must be unique</span>
            </label>-->

            <label for="email">
                <input *ngIf="emptyUser" name="email" [(ngModel)]="selectedUser.email" placeholder="write the username"> 
                
            </label>

                <span i18n>email</span>: {{selectedUser.email}}@{{system.domain}}
           
            <label for="name">
                <span i18n="@@name">name</span>:
                <input name="name" [(ngModel)]="selectedUser.name" required placeholder="write your name" />
            </label>
            <label>
                <span i18n="@@phonenumber">phone number</span>:
                <br/><input name="phone" [(ngModel)]="selectedUser.phone"  placeholder="phone number"  />
            </label>

            <label >
                <span i18n>site</span>:
                <br/><input name="site" [(ngModel)]="selectedUser.site" placeholder="website"  />
            </label>

            <div class="selector">
            <!--<ng-container *ngIf="stations">

                <select ng-model="selectedUser.location">
                    <option *ngFor="let station of stations" >{{station.alias}} | {{station.location}}</option>

                </select>
                </ng-container>
            -->
            </div>

            <!--
            <label>
                <span i18n>location</span>:
                <br/><input name="location" [(ngModel)]="selectedUser.location"  placeholder="location"  />
            </label>
            -->


            <label for="recovery">
                <span i18n>recovery phrase</span>:
                <br/><input  name="recoverphrase" [(ngModel)]="selectedUser.recoverphrase" required placeholder="write a question to recover your password" />
                <div *ngIf="f.invalid" i18n="@@titlereq">Title is required</div>
            </label>
            <label>
                <span i18n="@@recovans2">recovery answer</span>:
                <br/><input  name="recoveranswer" [(ngModel)]="selectedUser.recoveranswer" placeholder="answer to your recovery question"  />
            </label>

            <!--
            <hr>
                <span i18n>created at</span>: <span> {{selectedUser.created_at}}</span>
                <span i18n>updated at</span>: <span> {{selectedUser.updated_at}}</span>
            -->

            <hr>

           


            <label>
                <span i18n>password</span>:
                <br/>
                <!--<input id="password" name="password" type="password" [(ngModel)]="selectedUser.password" required  placeholder="password"  minlength="8" />-->
                <label for="passwd" >
                    <span i18n="@@typethepassword">Type the password</span>
                    <input id="password" name="password" type="password" [(ngModel)]="selectedUser.password" required  placeholder="password"  minlength="8" (input)="checkpass(selectedUser.password,repasswd)" />
                </label>
                <label for="repasswd" >
                    <span i18n="@@retypethepassword">Retype the password</span>
                    <input type="password"  [(ngModel)]="repasswd" [ngModelOptions]="{standalone: true}" minlength="8" (input)="checkpass(selectedUser.password,repasswd)"/>
                </label>
                <div [hidden]=!passunMatch class="error" i18n="@@passdontmatch">
                    passwords doesn't match
                </div>
                <div [hidden]=!passMin class="error" i18n="@@passempty">
                    passwords can't be empty
                </div>
                <span *ngIf="f.invalid" class="alert" i18n=@@strongpassword>passwords must have at least 8 characters</span>
        
        </label>

        <label *ngIf="isadmin">
            <span i18n>is admin</span>:
            <input name="admin" class="ckbx" type="checkbox" checked="false" [(ngModel)]="selectedUser.admin"  />
        </label>
            <br/>
                <button (click)="cancelCreate()" >cancel</button>
                <button (click)="deleteAlert()" [disabled]="admin" [hidden]="emptyUser">delete user</button>
                <button type="submit" [hidden]="emptyUser" (click)="updateAlert()" [disabled]="f.invalid">update</button>
                <button type="submit" [hidden]="!emptyUser" (click)="onSubmitCreate(f)" [disabled]="f.invalid || passunMatch">create user</button>

                <div class="overall" *ngIf="deleteUser">
                    <div class="cv" >
                    <span i18n="@@areyousuredelete">Are you sure you want to delete </span>{{selectedUser.name}}?<br/>
                    <span i18n="@@thisactioncannot">this action cannot be undone!</span>
                    <br/>
                    <button type="submit" (click)="onSubmitDelete(selectedUser.emailid, selectedUser.email)" i18n="@@deleteuser">delete user</button>
                    <button type="submit" (click)="deleteAlert()" i18n="@@cancel">cancel</button>
                </div>
                </div>

                <div class="overall" *ngIf="updateUser">
                    <div class="cv" >
                    <span i18n="@@areyousureupdate">Are you sure you wanna update</span> {{selectedUser.name}}?<br/>
                    <span i18n="@@thisactioncannot">this action cannot be undone!</span>
                    <br/>
                    <button type="submit" (click)="onSubmitUpdate(selectedUser.emailid,f)" [disabled]="f.invalid" i18n="@@update">update</button>
                    <button type="submit" (click)="updateAlert()" [disabled]="f.invalid" i18n="@@cancel">cancel</button>
                </div>
                </div>

                <div class="overall alert" [hidden]="errorAlert==false">
                    <div class="cv" >
                        <span i18n="@@errormanagemet">There was an error on precessing your request <br/><br/></span>
                        <span>{{error}}</span>
                        <div class="icon" ><a (click)="closeError()" >
                            <img title="compose" src="assets/svg/x.svg"></a>
                        </div>
        
                    </div>
                </div>
                
            
        </form>
    </ng-container>

</div>
